# Публичное Rest API (24-05-2022)
<!-- TOC -->

- [1. Общая информация](#1-общая-информация)
- [2. Коды возврата HTTP](#2-коды-возврата-http)
- [3. Коды ошибок](#3-коды-ошибок)
- [4. Лимиты](#4-лимиты)
    - [4.1. IP лимиты](#41-ip-лимиты)
- [5. Аутентификация и авторизация запросов](#5-аутентификация-и-авторизация-запросов)
- [6. Определение перечислений](#6-определение-перечислений)
    - [6.1. Статус заказа](#61-статус-заказа)
- [7. Методы API](#7-методы-api)
    - [7.1. Забронировать место для размещения заказа](#71-забронировать-место-для-размещения-заказа)

<!-- /TOC -->

## 1. Общая информация

_//не используем сырые массивы в ответах_
_//обязательно использование HTTPS_

- Базовая точка доступа для API: **<https://api.capsula24.com/>**
- В ответе всегда возвращается объект JSON
- Для `GET` запросов параметры должны быть отправлены как `query string`.
- Для `POST`, `PUT`, and `DELETE` запросов параметры должны быть отправлены в теле запроса как JSON объект.
- Параметры могут быть отправлены в любом порядке.

## 2. Коды возврата HTTP

Описание возможных кодов возврата HTTP

- HTTP `401` Источник запроса не авторизован
- HTTP `4XX` используются для некорректных запросов, когда отправитель неверно его сформировал.
- HTTP `429` используется при достижении лимита по частоте запросов.
- HTTP `5XX` используется при проблемах на стороне API.

## 3. Коды ошибок

В ответ на каждый запрос отправляется код результата выполнения.
Номальный код выполнения 1000. Это означает что сервер корректно обработал запрос и смог сформировать ожидаемый ответ. В противном случае смотри расшифровку в документе [Коды ответов API](./errors.md).

Пример:

```javascript
{
  "code": 1101,
  "msg": "Not enough space"
}
```

## 4. Лимиты

_//определить общий лимит и лимиты в рамках одного IP_

Описание возможных лимитов по частоте использования методов API.

- На все запросы устанавливатеся ограничение в ?
- При превышении заданной частоты запросов сервер ответит кодом `429`

### 4.1. IP лимиты

_// нужны лимиты по IP_

## 5. Аутентификация и авторизация запросов

_// Если нужна авторизация - нужно добавить заголовок_
Пример заголовка:
```https
Authorization: Basic NDIyNjoyNTBlNzBmYjgzYmIwYmI2YjJkYjkwMzYwZjI0YWUyMjhiM2I4Y2UyZTQyYjc1NGEzNDZhZGYyMmZhYzdkMjJl
```

## 6. Определение перечислений

### 6.1. Статус заказа

_// добавил статус для вновь созданного заказа_
_// статусы лучше делать с разрывами между соседними, чтобы можно было сделать новый статус между текущими или сделать подстатусы_

Заказы имеют следующие статусы:

- 0 - новый
- 10 - принят на хранение
- 20 - выдан
- 30 - просрочен
- 40 - просрочен, извлечен
- 50 - оформлено бронирование
- 60 - истек срок бронирования
- 70 - бронирование отменено

## 7. Методы API

### 7.1. Забронировать место для размещения заказа

```text
POST /api/v1/terminals/{terminal_id}/orders
```

_//В REST API работаем с существительными в URI, манипулируя этими сущностями с помощью методов POST, GET, DELETE и т.д._

Каждый авторизованный пользователь может создать новый заказ. Это приведет к бронированию места под него.
При бронировании в терминале резервируется место, достаточное для размещения заказа, указанного размера.

**Параметры в URI**

Имя | Тип | Обязательный | Значение по умолчанию | Описание
------------ | ------------ | ------------ | ---------- |------------
`terminal_id` | INT | YES | | Уникальный идентификатор терминала

**Параметры в теле запроса**

_//почему только высота и нет ширины и глубины?_

Имя | Тип | Обязательный | Значение по умолчанию | Описание
------------ | ------------ | ------------ | ---------- |------------
`box_height` | INT | YES | | Высота коробки в см. Максимальный размер не более 40 см.
`period` | INT | NO | 1 | Срок хранения заказа в сутках. Может принимать значение в диапазоне 1-14

**Результат**

Имя | Тип | Обязательный | Значение по умолчанию | Описание
------------ | ------------ | ------------ | ---------- |------------
`id` | INT | YES | | Уникальный идентификатор заказа.
`code` | INT | YES | | 5-ти значный код заказа
`status` | INT | YES | | [Статус заказа](#Статус-заказа)
`datetime` | TIMESTAMP | YES | | Дата и время бронирования в формате timestamp
`period` | INT | YES | | Срок хранения заказа

**Возможные коды ошибок**

- 1101 NO_SPACE
- 1102 NO_TERMINAL
- 1103 NO_FREE_TRAY
- 1104 MAX_HEIGHT_LIMIT
- 1105 INCORRECT_PERIOD

**Пример запроса**

`POST https://base_url/api/v1/terminals/999/orders`

```json
{
    "box_height": 20,
    "period": 4
}
```

**Пример успешного ответа**

```json
{
    "code": 1000, 
    "id": 123213,
    "status": 0,
    "box_height": 20,
    "period": 4
}
```

**Пример неуспешного ответа**

```json
{
    "code": 1101,
    "msg": "Not enough space"
}
```
