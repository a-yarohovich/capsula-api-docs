
# Публичное Rest API (//TODO - дата последней версии)

## Общая информация

* Базовая точка доступа для API: **<https://api.capsula24.com/>** //TODO - обязательно использование HTTPS
* В ответе всегда возвращается объект JSON //TODO - не используем сырые массивы в ответах
* Для `GET` запросов параметры должны быть отправлены как `query string`.
* Для `POST`, `PUT`, and `DELETE` запросов параметры должны быть отправлены в теле запроса как JSON объект.
* Параметры могут быть отправлены в любом порядке.

## Коды возврата HTTP

* HTTP `401` Источник запроса не авторизован
* HTTP `4XX` используются для некорректных запросов, когда отправитель неверно его сформировал.
* HTTP `429` используется при достижении лимита по частоте запросов.
* HTTP `5XX` используется при проблемах на стороне API.

## Error Codes

В ответ на каждый запрос отправляется код результата выполнения.
Номальный код выполнения 1000. Это означает что сервер корректно обработал запрос и смог сформировать ожидаемый ответ. В противном случае смотри расшифровку в документе [Коды ответов API](./errors.md).

Пример:

```javascript
{
  "code": 1101,
  "msg": "Not enough space"
}
```

## Лимиты

* На все запросы устанавливатеся ограничение в //TODO - определить общий лимит и лимиты в рамках одного IP
* При превышении заданной частоты запросов сервер ответит кодом `429`

### IP лимиты

// TODO - нужны лимиты по IP

## Аутентификация и авторизация запросов

// TODO Если нужна авторизация - нужно добавить заголовок
// Пример заголовка:

```https
Authorization: Basic NDIyNjoyNTBlNzBmYjgzYmIwYmI2YjJkYjkwMzYwZjI0YWUyMjhiM2I4Y2UyZTQyYjc1NGEzNDZhZGYyMmZhYzdkMjJl
```

## Определение перечислений

### Статус заказа

// TODO - добавил статус для вновь созданного заказа
// TODO - статусы лучше делать с разрывами между соседними, чтобы можно было сделать новый статус между текущими или сделать подстатусы

Заказы имеют следующие статусы:

* 0 - новый
* 10 - принят на хранение
* 20 - выдан
* 30 - просрочен
* 40 - просрочен, извлечен
* 50 - оформлено бронирование
* 60 - истек срок бронирования
* 70 - бронирование отменено

## Методы API

### Забронировать место для размещения заказа

```text
POST /api/v1/terminals/{terminal_id}/orders
```

//TODO - в REST API работаем с существительными в URI, манипулируя этими сущностями с помощью методов POST, GET, DELETE и т.д.

Каждый авторизованный пользователь может создать новый заказ. Это приведет к бронированию места под него.
При бронировании в терминале резервируется место, достаточное для размещения заказа, указанного размера.

#### Параметры в URI

Имя | Тип | Обязательный | Значение по умолчанию | Описание
------------ | ------------ | ------------ | ---------- |------------
`terminal_id` | INT | YES | | Уникальный идентификатор терминала

#### Параметры в теле запроса

//TODO - почему только высота и нет ширины и глубины?

Имя | Тип | Обязательный | Значение по умолчанию | Описание
------------ | ------------ | ------------ | ---------- |------------
`box_height` | INT | YES | | Высота коробки в см. Максимальный размер не более 40 см.
`period` | INT | NO | 1 | Срок хранения заказа в сутках. Может принимать значение в диапазоне 1-14

#### Результат

Имя | Тип | Обязательный | Значение по умолчанию | Описание
------------ | ------------ | ------------ | ---------- |------------
`id` | INT | YES | | Уникальный идентификатор заказа.
`code` | INT | YES | | 5-ти значный код заказа
`status` | INT | YES | | [Статус заказа](#Статус-заказа)
`datetime` | TIMESTAMP | YES | | Дата и время бронирования в формате timestamp
`period` | INT | YES | | Срок хранения заказа

#### Возможные коды ошибок

* 1101 NO_SPACE
* 1102 NO_TERMINAL
* 1103 NO_FREE_TRAY
* 1104 MAX_HEIGHT_LIMIT
* 1105 INCORRECT_PERIOD

#### Пример запроса

`POST https://base_url/api/v1/terminals/999/orders`

```json
{
    "box_height": 20,
    "period": 4
}
```

#### Пример успешного ответа

```json
{
    "code": 1000, 
    "id": 123213,
    "status": 0,
    "box_height": 20,
    "period": 4
}
```

#### Пример неуспешного ответа

```json
{
    "code": 1101,
    "msg": "Not enough space"
}
```
